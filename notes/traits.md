# トレイト

トレイトはメソッドとフィールドの定義をカプセル化したものであり、クラスに
ミックスインする事で再利用できる。クラスは複数のトレイトをいくつでも
ミックスインできる。理解のとっかかりとしては、Javaでいうインターフェイスの
ような、Rubyでいうモジュールのようなものと考えられるが、トレイトはその
どちらとも違う性質を持っている。
まずトレイトはフィールドや具象・抽象メソッドの定義、他クラスの継承や
他トレイトのミックスインなど、クラスででできるほとんど全ての事が可能であり、
Javaのインターフェイスよりもできる事が圧倒的に多い。よってむしろ通常のクラスの
方に近いといえる(インスタンス化できない事を考えれば抽象クラスに最も近い)。
その上でトレイトの特徴を挙げると以下の2点となる。

* クラスパラメータを受け取る事ができない。
* トレイト内で定義されたメソッドでは`super`を呼び出す事ができる。
この`super`の束縛は動的に行われる。

1つ目はある意味当然の制限だが、2つ目はトレイトの重要な特性と言える。

## 積み重ね可能な変更

自由にミックスインできるトレイトはそれだけで充分強力だが、トレイトの他にはない特性は
ある共通のスーパークラスを持つ複数のトレイトを組み合わせる時に発揮される
(具体例はコードを参照)。

例えばある2つのトレイトをミックスインした時、その2つのトレイトが全く同じ
シグネチャのメソッドを持っていた場合、Scalaではメソッド定義の衝突として
コンパイルエラーになる。Rubyであれば一番最初に`include`されたものが使われる
事を考えれば、融通にかけるような気もする。しかし共通クラスを継承する
トレイト同士であれば、この衝突をRubyよりも柔軟に解決する事ができる。
トレイト内の継承メソッドは`super`を呼び出す事ができる。そしてこの`super`が
何を参照するかは、通常のクラスで使用される場合とは違い、ミックスインの
され方で動的に変化するのである。簡単に言うと、最後にミックスインされた
トレイト(コード的にいうと一番右側に記述されたトレイト)のメソッドから
その前に追加されたトレイトのメソッドへと、`super`は順に遡っていく。
つまりいくつかのトレイトを定義しさえすれば、その組み合わせ方次第で様々な
バリエーションの機能を作成する事ができる。
トレイトの`super`呼び出しのルール(線形化の順序)は、コップ本にわかりやすい
例で記載されている(p. 227)。

ScalaもJavaも多重継承は禁止されている。そのためJavaで複数のクラスを
継承したい場合は、`A extends B, B extends C, ..`のように継承を直線的に重ねる
しかなかった。Scalaのトレイトはこの直線的な継承の連鎖を、サブクラスの定義時に
動的に決定できるような機能とも考えられるかもしれない。
(`A1 extends B with C, A2 extends C with B`)。
